name: Update _files.txt

on:
 push:
  branches: [main,master]

jobs:
 update_files:
  runs-on: ubuntu-latest
  steps:
   - name: Update _files.txt
     run: |
      find . -type f -name "_files.txt" | while read -r file; do
       dir="$(dirname "$file")"
       (
        cd "$dir" || exit
        find . -maxdepth 1 -type f ! -name "_files.txt" -printf "%P\n" | sort > _files.txt
       )
      done

   - name: Commit changes if any:
     run: |
      git config --global user.name "GitHub Actions"
      git config --global user.email "actions@github.com"
      if [[ -n "$(git status --porcelain)" ]]; then
       git add -A
       git commit -m "Automatically update _files.txt"
       git push
